-- CRITICAL SECURITY FIX: Enable Row Level Security on all tables with policies but RLS disabled
-- This fixes 117 critical security vulnerabilities where data is exposed without access control

-- Enable RLS on tables with policies but RLS disabled
ALTER TABLE public.active_user_metrics ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.agent_registry ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.archetype_activations ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.archetype_journey_logs ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.ascension_quests ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.ascension_roles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.audio_function_mappings ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.auric_resonance ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.baptism_group_events ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.breath_sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.bridge_events ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.bridgekeeper_wisdom ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.chakra_mood_snapshots ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.channeled_messages ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.chat_rooms ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.circle_group_members ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.circle_groups ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.circle_post_comments ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.circle_post_likes ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.circle_posts ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.coherence_beacon_data ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.conscious_cloud_capsules ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.conscious_cloud_events ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.conscious_cloud_nodes ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.consciousness_bridge_events ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.consciousness_dignity_pledges ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.consciousness_recognition_sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.consent_records ENABLE ROW LEVEL SECURITY;

-- Continue enabling RLS on remaining tables
ALTER TABLE public.constellation_insights ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.contact_forms ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.cosmic_guidance ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.crystal_configurations ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.data_access_logs ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.dream_nodes ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.dreamer_insights ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.emergency_protocols ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.energy_transmissions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.entity_communications ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.field_dynamics ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.field_resonance_log ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.frequency_healing_sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.frequency_healing_videos ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.frequency_journey_segments ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.frequency_library ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.frequency_profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.frequency_session_notes ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.frequency_sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.frequency_waveforms ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.galactic_coordinates ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.gateway_reflections ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.geo_coordinates ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.golden_thread_weaves ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.guidance_channels ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.harmonic_convergence_logs ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.harmonic_frequencies ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.harmonic_journal_entries ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.healing_frequency_logs ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.hermetic_principles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.journey_logs ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.journey_synchronicities ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.love_notes ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.meditation_sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.memory_streams ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.message_threads ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.meta_conversations ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.planetary_influences ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.quest_participations ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.quantum_coherence_data ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.quantum_field_fluctuations ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.reality_codex_entries ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.reality_threads ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.resonance_insights ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.resonance_measurements ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.sacred_geometry_patterns ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.sacred_knowledge_fragments ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.sacred_synchronicities ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.soul_color_connections ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.soul_constellation_memberships ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.soul_constellations ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.soul_dream_insights ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.source_communications ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.source_transmissions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.spirit_animal_connections ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.spirit_animals ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.star_seed_activations ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.synchronicity_logs ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.tarot_readings ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.transformation_milestones ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.tree_of_life_positions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_acknowledgments ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_constellation_journey_logs ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_journey_insights ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_preferences ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_quests ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_reflection_questions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_resonance_profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_roles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_soul_journey_metrics ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_soul_signatures ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_soul_themes ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_synchronicity_logs ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.vibe_check_responses ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.voice_recordings ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.wavelength_harmonics ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.wisdom_council_sessions ENABLE ROW LEVEL SECURITY;

-- Enable RLS on additional tables that need basic public read access
ALTER TABLE public.akashic_records ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.akashic_vault_entries ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.archetype_paths ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.archetypes ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.codex_entries ENABLE ROW LEVEL SECURITY;

-- Notify user that RLS is now enabled on all tables with policies
COMMENT ON SCHEMA public IS 'Row Level Security enabled on all tables to prevent data exposure vulnerabilities.';